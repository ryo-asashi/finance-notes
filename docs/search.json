[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Finance-Notes: Time Series and SDE",
    "section": "",
    "text": "This repository explores time-series and SDE models for finance, with a focus on their relationships and implementation in both R and Python.\nこのリポジトリは、ファイナンスにおける時系列モデルと確率微分方程式（SDE）モデルの両方について、その関係に注目しながら整理することを目的とした（数学を得意としない著者による）個人的な学習ノートです。",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>はじめに</span>"
    ]
  },
  {
    "objectID": "src/interest.html",
    "href": "src/interest.html",
    "title": "金利",
    "section": "",
    "text": "満期 \\(T\\) に額面 \\(1\\) を償還する割引債の時点 \\(t\\) における価格を \\(v(t, T)\\) で表し、その連続複利ベース最終利回り（スポットレート）を \\(\\delta(t, T)\\) とする。 スポットレートについて次の式が成立する。\n\\[\nv(t,T)=e^{-\\delta(t,T)(T-t)}\n\\]\nこれを \\(\\delta(t,T)\\) について解くことで次の式を得る。\n\\[\n\\delta(t,T)=-\\frac{\\ln v(t,T)}{T-t}\n\\]\n特に、信用リスクのない割引債の価格は将来価値を現在価値に換算するための割引率として用いられる。\nまた、\\(Y_t(u)=\\delta(t,t+u)\\) を時点 \\(t\\) における（連続複利ベースの）イールドカーブと呼ぶ。 イールドカーブはその時点における金利の期間構造を表している。\n満期までの時間 \\(h=T-t\\) を \\(0\\) に近づけるときの極限 \\(r(t)\\) を瞬間金利（瞬間スポットレート）という。\n\\[\nr(t)=\\lim_{h\\to 0}\\delta(t,t+h)\n=-\\lim_{h\\to 0}\\frac{\\ln v(t,t+h)}{h}\n=-\\frac{\\partial \\ln v(t,u)}{\\partial u}\\Bigg{|}_{u=t}\n\\]\n時点 \\(t\\) において、それより後の時点 \\(u\\) から満期 \\(T\\) まで割引債を保有することで得られる連続複利ベース利回り \\(\\delta_f(t,u,T)\\) をフォワードレートと呼ぶ。 フォワードレートについて次の式が成立する。\n\\[\nv(t,T)= v(t,u)\\;e^{-\\delta_f(t,u,T)(T-u)}\n\\]\nこの式を \\(\\delta_f\\) について解くことによって次の式を得る。\n\\[\n\\begin{align}\n\\\\ \\delta_f(t,u,T)&=-\\frac{\\ln v(t,T)-\\ln v(t,u)}{T-u}\n\\\\ &=\\frac{\\delta(t,T)(T-t)-\\delta(t,u)(u-t)}{T-u}\n\\end{align}\n\\]\nまた、将来時点から満期までの時間 \\(h=T-u\\) を \\(0\\) に近づけるときの極限 \\(f(t, u)\\) を瞬間フォワードレートと呼ぶ。\n\\[\nf(t,u) = \\lim_{h \\to 0} \\delta_f(t,u,u+h)\n= -\\frac{\\partial \\ln v(t,u)}{\\partial u}\n\\]\n瞬間フォワードレートは時点 \\(t\\) において予約された将来時点 \\(u\\) における「瞬間の利力」であり、これを用いると、割引債価格は \\(v(t, T) = \\exp \\left( -\\int_t^T f(t, s) ds \\right)\\) と表せる。\nまた、瞬間金利と瞬間フォワードレートの間には \\(f(t,t)=r(t)\\) という関係が成り立つ。\n期中にクーポンの支払いがある債券を利付債と呼び、特にクーポンが時点によらず一定であるものを固定利付債という。 時点 \\(t_1,t_2,\\dots,t_n\\) にクーポン \\(C_1,C_2,\\dots,C_n\\) を支払い、満期 \\(T=t_n\\) に額面 \\(1\\) を償還する割引債の時点 \\(t\\) における価格 \\(v_C(t, T)\\) は以下のように書ける。\n\\[\nv_C(t,T)=\\sum_{i=1}^{n-1} v(t,t_i)\\;C_i + v(t,T)\\;(1+C_n)\n\\]",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>金利</span>"
    ]
  },
  {
    "objectID": "src/returns.html",
    "href": "src/returns.html",
    "title": "収益率",
    "section": "",
    "text": "価格過程 \\(\\{S_t\\}_{0\\le t}\\) について、時点 \\(t\\) から \\(t+\\Delta t\\) までの微小時間における算術収益率 \\(R_a=R_a(t,t+\\Delta t)\\) と対数収益率 \\(R_\\ell=R_\\ell(t,t+\\Delta t)\\) を以下のように定義する。\n\\[\n\\begin{aligned}\nR_a &= \\frac{S_{t+\\Delta t}-S_t}{S_t}\n\\\\\nR_\\ell &= \\ln\\left(\\frac{S_{t+\\Delta t}}{S_t}\\right)\n\\end{aligned}\n\\]\nこのとき次が成立する。\n\\[\n\\begin{aligned}\nS_{t+\\Delta t}&=S_t\\;(1+R_a)\n\\\\\n&={S_t}\\;\\exp{(R_\\ell)}\n\\\\\\\\\nR_\\ell&=\\ln{(1+R_a)}\n\\end{aligned}\n\\]\nここで、\\(R_a = 0\\) の近傍では \\(R_\\ell=\\ln (1+R_a) \\approx R_a\\) であるから、価格の変化が十分小さければ算術収益率と対数収益率は互いに近い値をとる。\n\n\n\n\n\n\n\n\n\n対数収益率は時間方向の加法性を持つため、累積収益率の算出や多期間の統計分析において計算効率に優れている。 一方、算術収益率は資産間の加重平均がポートフォリオの収益率に一致するという資産方向の加法性を持つため、アセット・アロケーションの実務に適している。\n価格過程 \\(S_t\\) が次の幾何ブラウン運動で表されるとする。\n\\[\n\\frac{dS_t}{S_t} = \\mu dt + \\sigma dW_t\n\\]\nこの確率微分方程式をそのままオイラー-丸山法で離散化することで、微小時間における算術収益率に関する以下の式を得る。\n\\[\n\\frac{S_{t+\\Delta t} - S_t}{S_t} \\approx \\mu \\Delta t + \\sigma \\sqrt{\\Delta t}\\; \\epsilon_t\n\\]\nただし、この形式による離散化は \\(S_t\\) の非負性を保証せず、また、\\(\\Delta t\\) の大きさに応じた離散化誤差を生じることに注意が必要である。\n一方、幾何ブラウン運動において \\(f(S_t) = \\ln S_t\\) として伊藤の公式を適用することで、対数価格に関する次の式が得られる。\n\\[\nd(\\ln S_t) = \\left( \\mu - \\frac{1}{2}\\sigma^2 \\right) dt + \\sigma dW_t\n\\]\nこれを離散化することで、微小時間の対数収益率に関する次の式を得る。\n\\[\n\\ln\\left(\\frac{S_{t+\\Delta t}}{S_t}\\right) \\approx \\left( \\mu - \\frac{1}{2}\\sigma^2 \\right) \\Delta t + \\sigma \\sqrt{\\Delta t}\\;\\epsilon_t\n\\]\n対数収益率のドリフトは \\(\\mu - \\frac{1}{2}\\sigma^2\\) となり、算術収益率のドリフト \\(\\mu\\) からボラティリティの半分が差し引かれることがわかる。 つまり、実際に得られる連続複利ベースの累積収益率は、算術収益率の期待値を下回る。 この目減り分 \\(1/2\\sigma^2\\) はボラティリティタックスと呼ばれ、資産運用の長期的なパフォーマンスを規定する重要な要素となる。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>収益率</span>"
    ]
  },
  {
    "objectID": "src/euler-maruyama.html",
    "href": "src/euler-maruyama.html",
    "title": "確率微分方程式の離散化",
    "section": "",
    "text": "以下の形式の伊藤過程を考える。\n\\[\nX_t = X_0 + \\int_0^t \\mu_s\\ ds + \\int_0^t \\sigma_s\\ dW_s\n\\]\nこれを微分形式で記述すると、以下の確率微分方程式（SDE）となる。\n\\[\ndX_t = \\mu_t\\ dt + \\sigma_t\\ dW_t\n\\]\n伊藤過程の見本路はどんな精度で拡大しても細かく振幅しているはずのものであり、そのまま描画することはできない。そこで、時間 \\([0, T]\\) を \\(N\\) 等分して離散化することを考える。時間の刻み幅は \\(\\Delta t\\) と表記する。\n\\[\n\\Delta t = T / N\n\\]\nオイラー・丸山法（Euler-Maruyama approximation）では、伊藤過程を以下のように近似する。 ここで、\\(\\{\\epsilon_t\\}_t\\) は標準正規分布 \\(N(0, 1)\\) に従う互いに独立な確率変数である。\n\\[\n\\hat{X}_{t+\\Delta t} = \\hat{X}_t + \\mu_t \\Delta t + \\sigma_t \\sqrt{\\Delta t} \\epsilon_t\n\\]\nこの近似は、ウィーナー過程の増分 \\(dW_t = W_{t+\\Delta t} - W_t\\) が正規分布 \\(N(0, \\Delta t)\\) に従うという性質に基づいている。この増分の分散は \\(\\Delta t\\) であるから、標準正規分布に乗じる係数を \\(\\sqrt{\\Delta t}\\) とすべき点に注意する。\nウィーナー過程 \\(W_t\\) 自体は、伊藤過程においてドリフト項 \\(\\mu_t = 0\\)、拡散項 \\(\\sigma_t = 1\\) とした最も基本的なケースである。この過程のオイラー・丸山法による離散近似は以下のように表現できる。\n\\[\n\\hat{W}_{t+\\Delta t} = \\hat{W}_t + \\sqrt{\\Delta t} \\epsilon_t\n\\]\nこの過程は時系列分析におけるランダムウォークにほかならない。\n以下では、ウィーナー過程を離散化することで得られたランダムウォークの見本路を作成してプロットする。\n\nRPython\n\n\n\nlibrary(ggplot2)\ntheme_set(theme_bw())\n\nset.seed(42)\n\nN &lt;- 252\ndt &lt;- 1 / N\ntime &lt;- seq(0, 1, by = dt)\n\n# 標準正規乱数の生成と累積和の計算\ndf &lt;- list()\nfor (i in 1:25) {\n  dW &lt;- sqrt(dt) * rnorm(N)\n  path &lt;- cumsum(c(0, dW))\n  df[[length(df) + 1]] &lt;-\n    data.frame(id = i, time=time, path=path)\n}\ndf &lt;- do.call(rbind, df)\n\n# プロット\nggplot(df) +\n  geom_line(aes(time, path, group=id)) +\n  labs(\n    title = \"Discretized Wiener Process\",\n    x = \"Time (t)\", y = \"W(t)\"\n  )\n\n\n\n\nウィーナー過程のシミュレーション（R）\n\n\n\n\n\n\n\nimport numpy as np\nimport pandas as pd\nfrom plotnine import *\ntheme_set(theme_bw())\n\nnp.random.seed(42)\n\nN = 252\ndt = 1 / N\ntime = np.linspace(0, 1, N + 1)\n\n# 標準正規乱数の生成と累積和の計算\ndf = list()\nfor i in range(25):\n  dW = np.sqrt(dt) * np.random.normal(0, 1, N)\n  path = np.cumsum(np.insert(dW, 0, 0))\n  df.append(\n    pd.DataFrame({'id':i, 'time':time, 'path':path})\n  )\ndf = pd.concat(df)\n\n# プロット\nggplot(df) + \\\n  geom_line(aes(\"time\", \"path\", group=\"id\")) + \\\n  labs(\n    subtitle = \"Discretized Wiener Process\",\n    x = \"Time (t)\", y = \"W(t)\"\n  )\n\n\n\n\nウィーナー過程のシミュレーション（Python）",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>確率微分方程式の離散化</span>"
    ]
  },
  {
    "objectID": "src/vasicek.html",
    "href": "src/vasicek.html",
    "title": "Vasicekモデル",
    "section": "",
    "text": "Vasicek モデルは、金利が長期的にみれば一定の水準 \\(\\theta\\) に引き戻されるという平均回帰性 (Mean Reversion) を取り入れた瞬間金利のモデルである。\n確率微分方程式は以下で与えられる。\n\\[\ndr_t = \\kappa\\;(\\theta - r_t)\\;dt + \\sigma\\;dW_t\n\\]\nただし、\\(\\kappa\\) は長期平均金利への平均回帰速度、\\(\\theta\\) は長期平均金利の水準、\\(\\sigma\\) はボラティリティ、 \\(dW_t\\) はウィーナー過程である。\nシミュレーションのために、オイラー・丸山法を用いて離散化すると以下のようになる。\n\\[\nr_{t+\\Delta t} = r_t + \\kappa\\;(\\theta - r_t)\\;\\Delta t + \\sigma\\;\\sqrt{\\Delta t}\\;\\epsilon_t\n\\]\nこれを以下のように整理すると、Vasicekモデルを離散化したものは1次の自己回帰モデル AR(1) になることがわかる。\n\\[\nr_{t+\\Delta t} = \\kappa\\theta\\Delta t + (1 - \\kappa\\Delta t)\\;r_t + \\sigma\\;\\sqrt{\\Delta t}\\;\\epsilon_t\n\\] これが定常過程であるための条件は \\(|1-\\kappa\\Delta t|&lt;1\\) であり、その時の期待値は \\(\\theta\\) となる。\n以下は、初期金利を \\(r_0 = 1\\%\\)、ボラティリティを \\(\\sigma=2\\%\\)、長期平均金利を \\(\\theta=5\\%\\)、平均回帰速度を \\(\\kappa=0.5\\) に設定した場合のシミュレーション例である。時間の経過とともに瞬間短期金利が \\(5\\%\\) に近づいていく様子が確認できる。\n\nRPython\n\n\n\nlibrary(ggplot2)\ntheme_set(theme_bw())\n\nset.seed(42)\n\nyears &lt;- 10\nN &lt;- 100 * years\ndt &lt;- years / N\ntime &lt;- seq(0, years, by = dt)\n\nr0 &lt;- 0.01\nsigma &lt;- 0.02\ntheta &lt;- 0.05\nkappa &lt;- 0.5\nm &lt;- 25\n\n# オイラー・丸山法によるシミュレーション\nrt &lt;- rep(r0, m)\ndf &lt;- list()\ndf[[1]] &lt;- data.frame(id = 1:m, time=time[1], rate=rt)\nfor (i in seq_len(N)) {\n  drift &lt;- kappa * (theta - rt) * dt\n  diffusion &lt;- sigma * sqrt(dt) * rnorm(m)\n  rt &lt;- rt + drift + diffusion\n  df[[length(df) + 1]] &lt;-\n    data.frame(id = 1:m, time=time[1 + i], rate=rt)\n}\ndf &lt;- do.call(rbind, df)\n\n# プロット\nggplot(df) +\n  geom_hline(yintercept = theta, linetype = \"dashed\") +\n  geom_line(aes(time, rate, group=id)) +\n  labs(\n    title = \"Discretized Vasicek Model\",\n    x = \"Time (t)\", y = \"Rate (t)\"\n  )\n\n\n\n\nVasicek モデルの離散シミュレーション（R）\n\n\n\n\n\n\n\nimport numpy as np\nimport pandas as pd\nfrom plotnine import *\ntheme_set(theme_bw())\n\nnp.random.seed(42)\n\nyears = 10\nN = 100 * years\ndt = years / N\ntime = np.linspace(0, years, N + 1)\n\nr0 = 0.01\nsigma = 0.02\ntheta = 0.05\nkappa = 0.5\nm = 25\n\n# オイラー・丸山法によるシミュレーション\nrt = np.repeat(r0, m)\ndf = list()\ndf.append(pd.DataFrame({'id':range(m), 'time':time[0], 'rate':rt}))\n\nfor i in range(N):\n  drift = kappa * (theta - rt) * dt\n  diffusion = sigma * np.sqrt(dt) * np.random.normal(0, 1, m)\n  rt = rt + drift + diffusion\n  df.append(\n    pd.DataFrame({'id':range(m), 'time':time[1+i], 'rate':rt})\n  )\ndf = pd.concat(df)\n\n# プロット\nggplot(df) + \\\n  geom_hline(yintercept=theta, linetype=\"dashed\") + \\\n  geom_line(aes(\"time\", \"rate\", group=\"id\")) + \\\n  labs(\n    subtitle = \"Discretized Vasicek Model\",\n    x = \"Time (t)\", y = \"Rate (t)\"\n  )\n\n\n\n\nVasicek モデルの離散シミュレーション（Python）\n\n\n\n\n\n\n\nVasicek モデルでは、時点 \\(t\\) における残存期間 \\(s\\) の利回り \\(\\delta(t, t+s)\\) を以下のように表すことができる。\n\\[\n\\begin{align}\n\\delta(t, t+s) &= \\frac{A(s) - B(s)\\;r_t}{s}\\\\\nB(s) &= \\frac{1 - e^{-\\kappa s}}{\\kappa}\\\\\nA(s) &= (\\theta^Q - \\frac{\\sigma^2}{2\\kappa^2})(B(s) - s) - \\frac{\\sigma^2}{4\\kappa}B(s)^2\n\\end{align}\n\\]\nここで、\\(\\theta^Q\\) はリスク調整後の（リスク中立的）長期平均金利であり、モデルから導出される債券価格と市場で観測される債券価格の誤差を最小化するなどの方法で推定される。ヒストリカル・データなどに基づいて推定される長期平均金利 \\(\\theta^P\\) にリスクプレミアムを加えたものと理解することもできる。\\(\\theta^P\\) と \\(\\theta^Q\\) のどちらも Vasicek モデルで使用されうるが、前者によるモデルは純粋な金利予測やリスク管理のために利用され、後者によるモデルは債券や金利デリバティブの時価評価に利用される。\n\\(\\theta^P\\) と \\(\\theta^Q\\) の関係を敷衍しておく。\\(dW_t^P\\) がウィーナー過程となる確率測度における Vasicek モデルは以下の式で表現される。\n\\[\ndr_t = \\kappa\\;(\\theta^P - r_t)\\;dt + \\sigma\\;dW_t^P\\\\\n\\]\nこのモデルを \\(dW_t^Q = dW_t^P + \\lambda dt\\) を用いて以下のように変換する。\n\\[\n\\begin{align}\ndr_t &= \\kappa (\\theta^P - r_t)\\ dt + \\sigma\\ (dW_t^Q - \\lambda dt)\\\\\n&= \\kappa\\;[(\\theta^P - \\frac{\\sigma\\lambda}{\\kappa}) - r_t]\\;dt + \\sigma dW_t^Q\n\\end{align}\n\\]\nこの式は、\\(dW_t^Q\\) がウィーナー過程となる確率測度における Vasicek モデルとなる。係数の比較により以下の関係が従う。\n\\[\n\\theta^Q = \\theta^P - \\frac{\\sigma\\lambda}{\\kappa}\n\\]\n一般に市場のリスク価格 \\(\\lambda\\) は負の値をとることが多く、その場合 \\(\\theta^Q &gt; \\theta^P\\) となる。これは、市場がリスクを考慮して現実の平均的な予測よりも高めの金利をイールドカーブに織り込むことに対応している。\n以下、Vasicek モデルにおける複数の瞬間金利水準に対応する イールドカーブの形状をプロットする。\n\nlibrary(ggplot2)\n\nkappa  &lt;- 0.5\ntheta &lt;- 0.06\nsigma  &lt;- 0.02\n\n# 解析解の関数定義\nvasicek_yield &lt;- function(rt, s, kappa, theta, sigma) {\n  B &lt;- (1 - exp(-kappa * s)) / kappa\n  A &lt;- (\n    (theta - sigma^2 / (2 * kappa^2)) * (B - s)\n    - (sigma^2 / (4 * kappa)) * B^2\n  )\n  yield &lt;- (B * rt - A) / s\n  return(yield)\n}\n\n# 3つの異なる瞬間金利でのカーブを比較\ntenors &lt;- seq(0.1, 30, by = 0.1)\nr0_samples &lt;- c(0.03, 0.06, 0.09)\n\ndf &lt;- list()\nfor(r0 in r0_samples){\n  y &lt;- vasicek_yield(r0, tenors, kappa, theta, sigma)\n  df[[length(df) + 1]] &lt;-\n    data.frame(tenor=tenors, yield=y, rt=as.factor(r0))\n}\ndf &lt;- do.call(rbind, df)\n\n# プロット\nggplot(df) +\n  geom_line(aes(x=tenor, y=yield, linetype=rt)) +\n  labs(title = \"Yield Curves in Vasicek Model\",\n       x = \"Time to Maturity\", y = \"Yield\",\n       lty = \"Current Rate\")\n\n\n\n\n特定の時点 t におけるイールドカーブ（解析解）\n\n\n\n\n金利のモデルとしての Vasicek モデルには以下のような課題がある。\n\n瞬間金利が負値となる可能性がある\nVasicek モデルでは、金利自身の誤差項にウィーナー過程／正規分布を仮定するため、金利 \\(r_t\\) がマイナスになりうる。\nイールドカーブの形状が限定される\nVasicek モデルにおけるイールドカーブの形状は理論上単純な形に限定されており、複雑な凹凸を持つことがある現実のイールドカーブを初期条件として表現できないことがある。\nボラティリティが一定である\n金利には、現在の金利水準が低いほどボラティリティも小さい傾向があるとされる。しかし、そのような性質は Vasicek モデルでは表現できない。",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Vasicekモデル</span>"
    ]
  },
  {
    "objectID": "src/hull-white.html",
    "href": "src/hull-white.html",
    "title": "Hull-Whiteモデル",
    "section": "",
    "text": "Hull-Whiteモデルは、Vasicekモデルの平均回帰パラメータを時間依存させることにより、市場で観測される金利の期間構造に完全に適合できるように拡張された金利モデルである。市場価格と整合的な無裁定評価を行うための標準的なモデルの一つとして利用される。\nHull-White モデルは、瞬間短期金利 \\(r_t\\) をリスク中立測度 \\(Q\\) の下で次の確率微分方程式に従う確率過程として表現する。\n\\[\n\\begin{align}\ndr_t &= (\\theta(t) - \\alpha\\;r_t)\\; dt + \\sigma\\; dW_t\n\\\\\n&=\\alpha\\;(\\frac{\\theta(t)}{\\alpha}-r_t)\\;dt + \\sigma\\;dW_t\n\\end{align}\n\\]\nここで、\\(\\alpha\\) は平均回帰速度、\\(\\sigma\\) は拡散係数（ボラティリティ）、\\(W_t\\) はウィーナー過程であり、\\(\\theta(t) / \\alpha\\) は時間に依存する金利の平均回帰水準を表す。 なお、平均回帰速度や拡散係数も時間依存のパラメーターとして扱われることがある。\nHull-White の利点は、モデルに基づくイールドカーブを時点 \\(0\\) における市場のイールドカーブと整合させることができる点にある。 そのためには、\\(\\theta(t)\\) を以下のように決定する。\n\\[\n\\theta(t)\n= \\frac{\\partial f(0, t)}{\\partial t}\n+ \\alpha f(0, t)\n+ \\frac{\\sigma^2}{2\\alpha} (1 - e^{-2\\alpha t})\n\\]\nここで、\\(f(0, t)\\) は時点 \\(0\\) における満期 \\(t\\) の瞬間フォワード・レートであり、割引債債価格 \\(v(0, t)\\) との間に次の関係が成立する。\n\\[\nf(0, t) = - \\frac{\\partial \\ln v(0, t)}{\\partial t}\n\\]\nこのとき、Hull-Whiteモデルにおける割引債価格 \\(v(t,T)\\) は以下の式で表される。\n\\[\n\\begin{align}\nv(t,T) &= A(t,T)\\exp\\left(-B(t,T)\\;r_t\\right)\n\\\\\nB(t,T) &= \\frac{1-e^{-\\alpha\\;(T-t)}}{\\alpha}\n\\\\\nA(t,T)&=\\frac{v(0,T)}{v(0,t)} \\exp \\left(\nB(t,T)\\;f(0,t)\n-\\frac{\\sigma^{2}}{4\\alpha}(1-e^{-2\\alpha t})\\;B(t,T)^{2}\n\\right)\n\\end{align}\n\\]\nよって、連続複利ベースのゼロレート \\(\\delta(t,T)\\) やその期間構造 \\(Y_t(u)=\\delta(t,t+u)\\) を \\(r_t\\) に関する一次関数（アフィン写像）と見なすことができる。\n\\[\n\\begin{align}\n\\delta(t,T;\\ r_t)&=-\\frac{\\ln v(t,T)}{T-t}=\\frac{B(t,T)}{T-t}\\;r_t\n-\\frac{\\ln A(t,T)}{T-t}\n\\\\\n&=\\frac{1-e^{-\\alpha(T-t)}}{\\alpha(T-t)}\\;r_t\n+\\left(-\\frac{\\ln A(t,T)}{T-t}\\right)\n\\\\\n\\\\\nY_t(u;\\ r_t)&=\\frac{1-e^{-\\alpha u}}{\\alpha u}\\;r_t\n+\\left( -\\frac{\\ln A(t,t+u)}{u} \\right)\n\\end{align}\n\\]\n最後の式の右辺の第一項について、残存期間 \\(u\\) に依存する係数 \\(\\beta(u)=(1-e^{-\\alpha u})/(\\alpha u)\\) は \\(u \\to 0\\) で \\(\\beta(u) \\to 1\\)、\\(u \\to \\infty\\) で \\(\\beta(u) \\to 0\\) であるから、イールドカーブ \\(Y_t(u)\\) は残存期間が短期であるほど \\(r_t\\) に強く連動し、長期であるほど \\(r_t\\) の変化への反応が鈍くなっていく。 なお、\\(\\beta(u)\\) のグラフは平均回帰速度 \\(\\alpha\\) に応じて次のようになる。\n\n\n\n\n\n\n\n\n\nイールドカーブ \\(Y_t(u)\\) を表現する式は以下のように変形できる。\n\\[\n\\begin{align}\n-\\frac{\\ln A(t,t+u)}{u}\n&= -\\frac{\\ln ({v(0,t+u)}-{v(0,t)})}{u}\n- \\frac{B(t,t+u)}{u}\\;f(0,t)\n+ \\frac{\\sigma^{2}}{4\\alpha}(1-e^{-2\\alpha t})\\;B(t,t+u)^{2} / u\n\\\\\n&=\\delta_f(0,t,t+u)-\\beta(u)f(0,t)+\\frac{\\sigma^{2}}{4\\alpha}(1-e^{-2\\alpha t})\\;u\\beta(u)^2\n\\\\\n\\\\\nY_t(u;\\ r_t)\n&= \\delta_f(0,t,t+u)+\n[r_t-f(0,t)]\\;\\beta(u)+\n\\frac{\\sigma^{2}}{4\\alpha}(1-e^{-2\\alpha t})\\;u\\beta(u)^2\n\\end{align}\n\\]\n右辺の第一項は当初（時点 \\(0\\) において）予測されていた将来のイールドカーブに対応し、 第二項は時点 \\(t\\) における瞬間金利 \\(r_t\\) が当初の予想 \\(f(0,t)\\) から乖離した分だけイールドカーブをシフトさせる。 第三項は、金利のボラティリティ \\(\\sigma\\) に応じてイールドカーブをわずかに調整するための項であるとみなせる。\n以下、見本路を構築してプロットするために、オイラー・丸山法を用いて Hull-White モデルの離散化を行う。時間刻みを \\(\\Delta t\\) とすると、以下のように定数項が時間変化する時変 AR(1) 過程として表現できる。\n\\[\n\\begin{align}\nr_{t+\\Delta t} &= r_t + (\\theta(t) - \\alpha r_t)\\;\\Delta t + \\sigma \\sqrt{\\Delta t}\\; \\epsilon_t\\\\\n&= \\theta(t) \\Delta t + (1 - \\alpha \\Delta t)\\; r_t + \\sigma \\sqrt{\\Delta t}\\; \\epsilon_t\n\\end{align}\n\\]\nここで、時点 \\(0\\) における瞬間フォワードレートが傾き \\(\\gamma\\) の直線 \\(f(0, t) = r_0 + \\gamma t\\) であると仮定すると、\\(\\theta(t)\\) は次のような関数となる。\n\\[\n\\begin{align}\n\\theta(t) &= \\frac{\\partial f(0, t)}{\\partial t} + \\alpha f(0, t) + \\frac{\\sigma^2}{2\\alpha}(1 - e^{-2\\alpha t})\n\\\\\n&= \\gamma + \\alpha (r_0 + \\gamma t) + \\frac{\\sigma^2}{2\\alpha}(1 - e^{-2\\alpha t})\n\\end{align}\n\\]\nまた、イールドカーブについて次が成り立つ。\n\\[\n\\begin{align}\nY_0(t)&=\\delta(0,t)=\\frac{1}{t}\\int_0^{t}f(0,s)ds=r_0+\\frac{\\gamma}{2}t\n\\\\\n\\\\\nY_t(u;\\ r_t)\n&= \\delta_f(0,t,t+u)\n+ [r_t-f(0,t)]\\;\\beta(u)\n+ \\frac{\\sigma^{2}}{4\\alpha}(1-e^{-2\\alpha t})\\;u\\beta(u)^2\n\\\\\n&\\approx (r_0+\\gamma t+\\frac{\\gamma}{2}u)\n+ \\left[r_t-(r_0+\\gamma t)\\right] \\beta(u)\n\\end{align}\n\\]\nたとえば、\\(\\alpha=0.5\\)、\\(f(0, t) = 0.01 + 0.001 t\\) のとき、\\(t=10\\) におけるイールドカーブは次の図のようになる。\n\n\n\n\n\n\n\n\n\nこのカーブのベースラインは \\(Y_{10}(u)=0.02+0.0005u\\) であり、足元の瞬間金利の当初予測からの乖離に関する調整 \\((r_t-0.02)\\beta(u)\\) によってイールドカーブ全体が上下に移動する。 このため、Hull-White モデルにおけるイールドカーブは、年限の異なるイールドの（確定的なベースラインの経時的変化を除いた）確率的な変動が互いに完全相関してしまうという特徴を持つ。\n以下、離散化した Hull-White モデルの見本路を計算してプロットする。\n\nR\n\n\n\nlibrary(ggplot2)\ntheme_set(theme_bw())\n\n# parameters\nyears  &lt;- 10\nnsteps &lt;- 252 * years\ndt     &lt;- years / nsteps\ntimes  &lt;- seq(0, years, by = dt)\nnpaths &lt;- 50\n\nr0    &lt;- 0.01\nalpha &lt;- 0.5\nsigma &lt;- 0.01\ngamma &lt;- 0.001\n\n# function to calculate theta\ntheta &lt;- function(t) {(\n  gamma\n  + alpha * (r0 + gamma * t)\n  + (sigma ^ 2 / (2 * alpha)) * (1 - exp(-2 * alpha * t))\n)}\n\n# simulation\nset.seed(42)\n\ndf &lt;- list()\n\nfor (i in seq_len(npaths)) {\n  sim_path &lt;- numeric(nsteps + 1)\n  sim_path[1] &lt;- r0\n  for (j in seq_len(nsteps)) {\n    t &lt;- times[j]\n    rt &lt;- sim_path[j]\n    dr &lt;- (theta(t) - alpha * rt) * dt + sigma * sqrt(dt) * rnorm(1)\n    sim_path[j + 1] &lt;- rt + dr\n  }\n  df[[length(df) + 1]] &lt;-\n    data.frame(id = i, time = times, rate = sim_path)\n}\n\ndf &lt;- do.call(rbind, df)\n\n# visualization\nggplot(df, aes(x = time, y = rate, group = id, alpha = id)) +\n  geom_line() +\n  labs(title = \"Sample Paths of Hull-White Model\",\n       x = quote(t), y = quote(r[t])) +\n  theme(legend.position = \"none\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Hull-Whiteモデル</span>"
    ]
  },
  {
    "objectID": "src/gbm.html",
    "href": "src/gbm.html",
    "title": "幾何ブラウン運動",
    "section": "",
    "text": "幾何ブラウン運動は、対数 \\(\\ln S_t\\) がドリフト付きブラウン運動に従う連続時間の確率過程である。\nブラック・ショールズ・モデルにおける危険資産の価格過程のモデル化に用いられるのが一般的だが、価格が負の値をとらない（非負性）という性質を持つため、Vasicek モデル等で課題となる「負の金利」を回避する目的で、瞬間金利のモデルとして用いられることもある。\nGBM モデルでは、資産価格 \\(S_t\\) を以下の確率微分方程式で記述する。\n\\[\ndS_t = \\mu S_t dt + \\sigma S_t dW_t\n\\]\nここで、\\(\\mu\\) は期待収益率（ドリフト）、\\(\\sigma\\) はボラティリティ、\\(W_t\\) は標準ウィーナー過程を表す。 この式は、微小時間における価格の変化量 \\(dS_t\\) が、その時の価格水準 \\(S_t\\) に比例することを意味している。\n関数 \\(f(S_t) = \\ln S_t\\) に対して伊藤の公式を適用することで、幾何ブラウン運動モデルに従う資産価格の対数価格 \\(\\ln S_t\\) に関する次の式を得る。\n\\[\nd(\\ln S_t) = \\left( \\mu - \\frac{1}{2}\\sigma^2 \\right) dt + \\sigma dW_t\n\\]\nこの変換で得られた式はドリフト付きのウィーナー過程である。\n初期値を \\(S_0\\) とするとき、解は次のように表せる。\n\\[\nS_t = S_0 \\exp \\left( \\left( \\mu-\\frac{1}{2} \\sigma^2 \\right)t+\\sigma W_t \\right)\n\\]\n対数価格に関する確率微分方程式を時間刻み \\(\\Delta t\\) で離散化することで、以下の時系列モデルを得る。\n\\[\n\\ln S_{t+\\Delta t}-\\ln S_t=\\ln \\left( \\frac{S_{t+\\Delta t}}{S_t} \\right) = \\left( \\mu - \\frac{1}{2}\\sigma^2 \\right) \\Delta t + \\sigma \\sqrt{\\Delta t}\\; \\epsilon_t\n\\]\nこのモデルでは、各微小時間の対数収益率は、それぞれ一定の平均と分散を持つ独立な正規分布に従う。 つまり、離散化された GBM モデルは、対数価格に対して定数項付きの単位根過程を仮定することに他ならない。\n\nR\n\n\n\nlibrary(ggplot2)\ntheme_set(theme_bw())\n\nset.seed(42)\n\nyears &lt;- 10\nN &lt;- 252 * years\ndt &lt;- years / N\ntime &lt;- seq(0, years, by = dt)\n\nS0 &lt;- 100\nmu &lt;- 0.05\nsigma &lt;- 0.2\nm &lt;- 100\n\ndf &lt;- list()\nfor (i in seq_len(m)) {\n  drift &lt;- (mu - sigma ** 2 / 2) * dt\n  diffusion &lt;- sigma * sqrt(dt) * rnorm(N)\n  dlnS &lt;- drift + diffusion\n  path &lt;- S0 * exp(cumsum(c(0, dlnS)))\n  df[[length(df) + 1]] &lt;-\n    data.frame(id = i, time = time, path = path)\n}\ndf &lt;- do.call(rbind, df)\n\nggplot(df, aes(x = time, y = path, group = id, alpha = id)) +\n  geom_line() +\n  scale_color_continuous() +\n  labs(title = \"Discretized Geometric Brownian Motion\",\n       x = \"Time (Years)\", y = \"Price\") +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\n\n\n価格過程 \\(S_t\\) が幾何ブラウン運動でモデル化される場合、各時点における対数価格が正規分布に従うことから、元の価格は対数正規分布に従う。 そのことは、数値シミュレーションの結果からも以下のように確認できる。\n\nR\n\n\n\nsnapshots &lt;- df$time[N %/% 1:6]\ndf_snapshots &lt;- df[df$time %in% snapshots, ]\nggplot() +\n  geom_density(\n    aes(path, group = time, fill = time),\n    data = df_snapshots,\n    alpha = 0.5,\n    ) +\n  lims(x = c(0, NA)) +\n  labs(subtitle = \"Realized Distribution of the Price\",\n       x = \"Price\", y = \"Density\")",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>幾何ブラウン運動</span>"
    ]
  },
  {
    "objectID": "src/monte-carlo.html",
    "href": "src/monte-carlo.html",
    "title": "モンテカルロ法",
    "section": "",
    "text": "モンテカルロ法とは、乱数を用いた数値計算法の総称である。 複雑なペイオフを持つ派生証券（デリバティブ）の中には、原資産価格のモデルが単純であっても、解析解に基づく価格公式を得られないものが少なくない。 そのような場合でも、モンテカルロ法を用いることで数値的な評価が可能となる。\n具体的な価格評価の手順としては、まずリスク中立測度に基づいて原資産価格のシミュレーション（見本路の発生）を行う。 次に、得られた各パスにおけるペイオフの平均値を算出し、それを現在価値に割り戻すことで証券価格を推定する。\n原証券価格 \\(S_t\\) がリスク中立測度 \\(Q\\) の下で次の確率微分方程式（幾何ブラウン運動モデル）に従うとする。\n\\[\n\\frac{dSt}{S_t}=rdt+\\sigma dW_t\n\\]\nこの確率微分方程式の解は次の式で与えられる。\n\\[\nS_t=S_0\\exp\\left[\\left(r-\\frac{\\sigma^2}{2}\\right)t+\\sigma W_t\\right]\n\\]\nヨーロピアン派生証券のペイオフ \\(f(S_T)\\) は満期 \\(T\\) における価格 \\(S_T\\) のみに依存する。 標準ウィーナー過程 \\(W_T\\) は平均 \\(0\\)、分散 \\(T\\) の正規分布に従うので、シミュレーションのために生成される標準正規乱数を \\(\\epsilon_t\\) として \\(W_t=\\sqrt T \\epsilon_t\\) とすれば、見本路に対応するペイオフを計算することができる。 生成する見本路の数を \\(M\\)、対応する原資産価格を \\(s^{(j)}_T\\) とすれば、ヨーロピアン派生証券の価格について、モンテカルロ法による推定値 \\(\\pi\\) を以下のように決定することができる。\n\\[\n\\begin{align}\n\\pi&=e^{-rT}\\mathbf{E}^Q[f(S_T)]\n\\\\\n&\\approx e^{-rT}\\frac{1}{M}\\sum_{j=1}^Mf(s^{(j)}_T)\n\\end{align}\n\\]\nヨーロピアン派生証券のように、ペイオフが満期価格 \\(S_T\\) のみに依存する場合、期待値計算を解析的に実行できる。 たとえば、ヨーロピアン・コールの価格をリスク中立測度 \\(Q\\) の下での期待値 \\(\\pi = e^{-rT}\\mathbf{E}^Q[(S_T - K)^+]\\) として計算すると、以下のブラック・ショールズ公式が導かれる。\n\\[\nC(S_0, t) = S_0 \\Phi(d_1) - Ke^{-r(T-t)} \\Phi(d_2)\n\\]\nここで、\\(\\Phi(x)\\) は標準正規分布の累積分布関数であり、\\(d_1, d_2\\) は以下の通り定義される。\n\\[\n\\begin{aligned}\nd_1 &= \\frac{\\ln\\left(\\frac{S_0}{K}\\right) + \\left(r + \\frac{\\sigma^2}{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\n\\\\\nd_2 &= d_1 - \\sigma\\sqrt{T-t} = \\frac{\\ln\\left(\\frac{S_0}{K}\\right) + \\left(r - \\frac{\\sigma^2}{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\n\\end{aligned}\n\\]\n以下のコードでは、行使価格 \\(K\\) のヨーロピアン・コールの価格をモンテカルロ法によって評価し、ブラックショールズモデルに基づく解析解と比較している。\n\nR\n\n\n\n# parameters\ns_0   &lt;- 110\nK     &lt;- 100\ntenor &lt;- 1\nr     &lt;- 0.1\nsigma &lt;- 0.2\nM     &lt;- 1000 # size of sample in one simulation\nN     &lt;- 1000 # number of simulations\n\n# Monte Carlo Simulation\nset.seed(42)\ndrift     &lt;- (r - sigma ^ 2 / 2) * tenor\ndiffusion &lt;- sigma * sqrt(tenor) * rnorm(M * N)\ns_T       &lt;- s_0 * exp(drift + diffusion)\n\npayoff &lt;- pmax(s_T - K, 0)\npayoff_mat &lt;- matrix(payoff, nrow = N, ncol = M)\npremium_mc &lt;- exp(-r * tenor) * rowMeans(payoff_mat)\ncat(\"Monte Carlo Price: \", premium_mc[1:3], \"...\\n\")\n\nMonte Carlo Price:  22.16895 21.16513 20.4242 ...\n\n# Black-Scholes Analytical Solution\nd1 &lt;- (log(s_0 / K) + (r + sigma^2 / 2) * tenor) / (sigma * sqrt(tenor))\nd2 &lt;- d1 - sigma * sqrt(tenor)\n\npremium_bs &lt;- s_0 * pnorm(d1) - K * exp(-r * tenor) * pnorm(d2)\ncat(\"Black-Scholes Price:\", premium_bs, \"\\n\")\n\nBlack-Scholes Price: 21.24877 \n\n# distribution of estimated prices\nlibrary(ggplot2)\ntheme_set(theme_bw())\nggplot() +\n  geom_density(aes(premium_mc)) +\n  geom_vline(xintercept = premium_bs,\n             linetype = \"dashed\") +\n  labs(subtitle = \"Monte Carlo Simulation of European Call Price\",\n       x = \"Premium\", y = \"Density\")\n\n\n\n\n\n\n\n\n\n\n\nモンテカルロ法の利点は、ペイオフが原資産価格の推移に依存する経路依存型オプションの評価が可能なことにある。 ここではその一例として、変動行使価格型ルックバック・コールオプションの価格評価を行う。 このオプションの満期におけるペイオフは、満期価格と取引期間中の最低価格の差 \\(\\max(S_T-\\min_{0\\le t\\le T}S_t, 0)\\) として定義される。\n\nR\n\n\n\n# parameters\ntenor &lt;- 1\nntime &lt;- 100 # number of time spans\ndt    &lt;- tenor / ntime\ntime  &lt;- seq(0, tenor, by = dt)\n\ns_0   &lt;- 100\nr     &lt;- 0.1\nsigma &lt;- 0.2\n\nM     &lt;- 1000 # size of sample in one simulation\n\n# simulation\nset.seed(42)\n\ndrift     &lt;- (r - sigma^2 / 2) * dt\ndiffusion &lt;- matrix(sigma * sqrt(dt) * rnorm(M * ntime), nrow = M)\nincrements &lt;- drift + diffusion\n\nlog_paths &lt;- cbind(rep(0, M), t(apply(increments, 1, cumsum)))\npaths     &lt;- s_0 * exp(log_paths)\n\ns_T    &lt;- paths[, ntime + 1]\ns_min  &lt;- apply(paths, 1, min)\npayoff &lt;- pmax(s_T - s_min, 0)\n\npremium_lb &lt;- exp(-r * tenor) * mean(payoff)\ncat(\"Monte Carlo Lookback Price: \", premium_lb)\n\nMonte Carlo Lookback Price:  18.21477\n\ndf &lt;- data.frame(\n  id = rep(seq_len(100), each = ntime + 1),\n  time = time,\n  path = as.numeric(t(paths[1:100, ]))\n)\n\nggplot(df, aes(x = time, y = path, group = id, alpha = id)) +\n  geom_line() +\n  scale_color_continuous() +\n  labs(subtitle = \"Sample Paths\",\n       x = \"Time\", y = \"Asset Price\") +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\nggplot() +\n  geom_density(aes(x = payoff)) +\n  geom_vline(xintercept = premium_lb,\n             linetype = \"dashed\") +\n  labs(subtitle = \"Distribution of Dayoff\",\n       x = \"Payoff\", y = \"Density\")",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>モンテカルロ法</span>"
    ]
  }
]
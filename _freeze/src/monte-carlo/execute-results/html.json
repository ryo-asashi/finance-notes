{
  "hash": "d6297cd88c0f959fee589f99bdb9af3f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"モンテカルロ法\"\n---\n\nモンテカルロ法とは、乱数を用いた数値計算法の総称である。\n複雑なペイオフを持つ派生証券（デリバティブ）の中には、原資産価格のモデルが単純であっても、解析解に基づく価格公式を得られないものが少なくない。\nそのような場合でも、モンテカルロ法を用いることで数値的な評価が可能となる。\n\n具体的な価格評価の手順としては、まずリスク中立測度に基づいて原資産価格のシミュレーション（見本路の発生）を行う。\n次に、得られた各パスにおけるペイオフの平均値を算出し、それを現在価値に割り戻すことで証券価格を推定する。\n\n原証券価格 $S_t$ がリスク中立測度 $Q$ の下で次の確率微分方程式（幾何ブラウン運動モデル）に従うとする。\n\n$$\n\\frac{dSt}{S_t}=rdt+\\sigma dW_t\n$$\n\nこの確率微分方程式の解は次の式で与えられる。\n\n$$\nS_t=S_0\\exp\\left[\\left(r-\\frac{\\sigma^2}{2}\\right)t+\\sigma W_t\\right]\n$$\n\nヨーロピアン派生証券のペイオフ $f(S_T)$ は満期 $T$ における価格 $S_T$ のみに依存する。\n標準ウィーナー過程 $W_T$ は平均 $0$、分散 $T$ の正規分布に従うので、シミュレーションのために生成される標準正規乱数を $\\epsilon_t$ として $W_t=\\sqrt T \\epsilon_t$ とすれば、見本路に対応するペイオフを計算することができる。\n生成する見本路の数を $M$、対応する原資産価格を $s^{(j)}_T$ とすれば、ヨーロピアン派生証券の価格について、モンテカルロ法による推定値 $\\pi$ を以下のように決定することができる。\n\n$$\n\\begin{align}\n\\pi&=e^{-rT}\\mathbf{E}^Q[f(S_T)]\n\\\\\n&\\approx e^{-rT}\\frac{1}{M}\\sum_{j=1}^Mf(s^{(j)}_T)\n\\end{align}\n$$\n\nヨーロピアン派生証券のように、ペイオフが満期価格 $S_T$ のみに依存する場合、期待値計算を解析的に実行できる。\nたとえば、ヨーロピアン・コールの価格をリスク中立測度 $Q$ の下での期待値 $\\pi = e^{-rT}\\mathbf{E}^Q[(S_T - K)^+]$ として計算すると、以下のブラック・ショールズ公式が導かれる。\n\n$$\nC(S_0, t) = S_0 \\Phi(d_1) - Ke^{-r(T-t)} \\Phi(d_2)\n$$\n\nここで、$\\Phi(x)$ は標準正規分布の累積分布関数であり、$d_1, d_2$ は以下の通り定義される。\n\n$$\n\\begin{aligned}\nd_1 &= \\frac{\\ln\\left(\\frac{S_0}{K}\\right) + \\left(r + \\frac{\\sigma^2}{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\n\\\\\nd_2 &= d_1 - \\sigma\\sqrt{T-t} = \\frac{\\ln\\left(\\frac{S_0}{K}\\right) + \\left(r - \\frac{\\sigma^2}{2}\\right)(T-t)}{\\sigma\\sqrt{T-t}}\n\\end{aligned}\n$$\n\n以下のコードでは、行使価格 $K$ のヨーロピアン・コールの価格をモンテカルロ法によって評価し、ブラックショールズモデルに基づく解析解と比較している。\n\n::: {.panel-tabset}\n\n## R\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# parameters\ns_0   <- 110\nK     <- 100\ntenor <- 1\nr     <- 0.1\nsigma <- 0.2\nM     <- 1000 # size of sample in one simulation\nN     <- 1000 # number of simulations\n\n# Monte Carlo Simulation\nset.seed(42)\ndrift     <- (r - sigma ^ 2 / 2) * tenor\ndiffusion <- sigma * sqrt(tenor) * rnorm(M * N)\ns_T       <- s_0 * exp(drift + diffusion)\n\npayoff <- pmax(s_T - K, 0)\npayoff_mat <- matrix(payoff, nrow = N, ncol = M)\npremium_mc <- exp(-r * tenor) * rowMeans(payoff_mat)\ncat(\"Monte Carlo Price: \", premium_mc[1:3], \"...\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMonte Carlo Price:  22.16895 21.16513 20.4242 ...\n```\n\n\n:::\n\n```{.r .cell-code}\n# Black-Scholes Analytical Solution\nd1 <- (log(s_0 / K) + (r + sigma^2 / 2) * tenor) / (sigma * sqrt(tenor))\nd2 <- d1 - sigma * sqrt(tenor)\n\npremium_bs <- s_0 * pnorm(d1) - K * exp(-r * tenor) * pnorm(d2)\ncat(\"Black-Scholes Price:\", premium_bs, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBlack-Scholes Price: 21.24877 \n```\n\n\n:::\n\n```{.r .cell-code}\n# distribution of estimated prices\nlibrary(ggplot2)\ntheme_set(theme_bw())\nggplot() +\n  geom_density(aes(premium_mc)) +\n  geom_vline(xintercept = premium_bs,\n             linetype = \"dashed\") +\n  labs(subtitle = \"Monte Carlo Simulation of European Call Price\",\n       x = \"Premium\", y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](monte-carlo_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n:::\n\n\nモンテカルロ法の利点は、ペイオフが原資産価格の推移に依存する経路依存型オプションの評価が可能なことにある。\nここではその一例として、変動行使価格型ルックバック・コールオプションの価格評価を行う。\nこのオプションの満期におけるペイオフは、満期価格と取引期間中の最低価格の差 $\\max(S_T-\\min_{0\\le t\\le T}S_t, 0)$ として定義される。\n\n::: {.panel-tabset}\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# parameters\ntenor <- 1\nntime <- 100 # number of time spans\ndt    <- tenor / ntime\ntime  <- seq(0, tenor, by = dt)\n\ns_0   <- 100\nr     <- 0.1\nsigma <- 0.2\n\nM     <- 1000 # size of sample in one simulation\n\n# simulation\nset.seed(42)\n\ndrift     <- (r - sigma^2 / 2) * dt\ndiffusion <- matrix(sigma * sqrt(dt) * rnorm(M * ntime), nrow = M)\nincrements <- drift + diffusion\n\nlog_paths <- cbind(rep(0, M), t(apply(increments, 1, cumsum)))\npaths     <- s_0 * exp(log_paths)\n\ns_T    <- paths[, ntime + 1]\ns_min  <- apply(paths, 1, min)\npayoff <- pmax(s_T - s_min, 0)\n\npremium_lb <- exp(-r * tenor) * mean(payoff)\ncat(\"Monte Carlo Lookback Price: \", premium_lb)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMonte Carlo Lookback Price:  18.21477\n```\n\n\n:::\n\n```{.r .cell-code}\ndf <- data.frame(\n  id = rep(seq_len(100), each = ntime + 1),\n  time = time,\n  path = as.numeric(t(paths[1:100, ]))\n)\n\nggplot(df, aes(x = time, y = path, group = id, alpha = id)) +\n  geom_line() +\n  scale_color_continuous() +\n  labs(subtitle = \"Sample Paths\",\n       x = \"Time\", y = \"Asset Price\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](monte-carlo_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot() +\n  geom_density(aes(x = payoff)) +\n  geom_vline(xintercept = premium_lb,\n             linetype = \"dashed\") +\n  labs(subtitle = \"Distribution of Dayoff\",\n       x = \"Payoff\", y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](monte-carlo_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "monte-carlo_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}